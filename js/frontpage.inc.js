!function(o){"use strict";var l=main_data.debug,c=frontpage_data.rest_url,p="&astrodj_api_key="+main_data.api_key+"&astrodj_api_secret="+main_data.api_secret;o(window).on("load",function(){o(".widget-loader-wrapper").remove(),o(".gallery-item").each(function(t){var e=o(this),a=1+Math.floor(6*Math.random());setTimeout(function(){e.css({opacity:"1",visibility:"visible"})},150*a)})}),o(document).ready(function(){var t=o("#page").outerHeight(),e=Math.round(o(".recent-posts").outerHeight()),a=o(".recent-posts article").outerHeight(),t=t-e;function n(){var i=o("#loader_container"),s=i.offset().top-o(window).outerHeight();o(window).on("scroll",function(t){var d,e;function a(i){var t,e,a,s=i.featured_media;function r(){return'<header class="entry-header"><span class="posted-on"><time class="entry-date published">'+i.astrodj_date+'</time></span><div class="entry-meta"><span class="cat-links">'+function(){for(var t=i._embedded["wp:term"][0],e=[],a=0;a<t.length;a++)e.push('<a href="'+t[a].link+'" rel="category tag">'+t[a].name+"</a>");return e.join(", ")}()+'</span></div><h2 class="entry-title"><a href="'+i.link+'" rel="bookmark">'+i.title.rendered+"</a></h2></header>"}a='<article id="post-'+i.id+'" class="astrodj-post post front-page-infinite" data-previous-id="'+i.previous_post_ID+'"><div class="post__content">'+r()+(0===s?"":(t=(s=i._embedded["wp:featuredmedia"][0]).media_details.sizes.full.width,e=s.media_details.sizes.full.height,a="vertical"===i.meta.featured_image_format_meta?" vertical":"",'<div class="post-thumbnail-header"><a href="'+i.link+'"><figure class="astrodj-lqip post-thumbnail blog-thumbnail'+a+'" data-alt="'+s.alt_text+'" data-src="'+s.media_details.sizes.full.source_url+'" ><div class="aspect-ratio-fill" style="padding-bottom: 66.7%;width: 100%;height: 0;"></div><div class="astrodj-lqip__wrap"><img width="'+t+'" height="'+e+'" alt="" class="placeholder" src="'+s.media_details.sizes.astrodj_lqip.source_url+'"></div><div class="astrodj-lqip__wrap"><img width="'+t+'" height="'+e+'" class="lazy"></div></figure></a></div>'))+(""===i.excerpt.rendered?"":'<div class="entry-content">'+i.excerpt.rendered+"</div>")+"</div></article>",d.before(a),setInterval(function(){d.prev(".front-page-infinite").addClass("loaded")},150),d.find(".lds-ellipsis").hide(),n()}s>o(window).scrollTop()||(e=(d=i).prev("article").data("previous-id"),e=c+e+"?_embed=true"+p,d.find(".lds-ellipsis").show(),o.ajax({dataType:"json",url:e}).done(function(t){a(t),r()}).fail(function(){l&&console.log("error"),d.find(".lds-ellipsis").hide(),d.replaceWith('<article class=""><p>Постов больше нет...</p></article>')}),o(this).off(t))})}function r(){var s,t=[].slice.call(document.querySelectorAll("img.lazy"));"IntersectionObserver"in window&&(s=new IntersectionObserver(function(t,e){t.forEach(function(t){var e,a,i;t.isIntersecting&&(t=(e=t.target).closest(".astrodj-lqip__wrap").previousElementSibling,a=t.firstElementChild,i=e.closest("figure"),t.classList.add("bg"),setTimeout(function(){a.classList.add("visible"),e.alt=i.hasAttribute("data-alt")?i.dataset.alt:"",e.src=i.dataset.src,e.srcset=i.hasAttribute("data-srcset")?i.dataset.srcset:"",e.sizes=i.hasAttribute("data-sizes")?i.dataset.sizes:"",e.addEventListener("load",function(t){t.target.classList.add("visible")}),s.unobserve(e)},300))})},{threshold:.25}),t.forEach(function(t){s.observe(t)})),o("img.lazy").each(function(t){var e=parseInt(o(this).attr("width")),a=parseInt(o(this).attr("height")),a=a<e?100/(e/a):100*(a/e);o(this).parents(".astrodj-lqip__wrap").prevAll(".aspect-ratio-fill").attr("style","padding-bottom: "+a+"%;width: 100%;")})}e===Math.round(o(window).outerHeight()-t)?(t=Math.ceil(e/a),l&&console.log(t),o.ajax({type:"post",data:{posts_per_page:t,action:"astrodj_frontpage_init_query"},url:main_data.ajax_url}).done(function(t){o("#loader_container").before(t),r(),n()}).fail(function(){})):n()})}(jQuery);