!function(l){"use strict";var n=main_data.debug,c=frontpage_data.rest_url,p="&astrodj_api_key="+main_data.api_key+"&astrodj_api_secret="+main_data.api_secret;l(window).on("load",function(){l(".widget-loader-wrapper").remove(),l(".gallery-item").each(function(e){var t=l(this),a=1+Math.floor(6*Math.random());setTimeout(function(){t.css({opacity:"1",visibility:"visible"})},150*a)})}),l(document).ready(function(){var e=l("#page").outerHeight(),t=Math.round(l(".recent-posts").outerHeight()),a=l(".recent-posts article").outerHeight(),e=e-t;function d(){var i=l("#loader_container"),s=i.offset().top-l(window).outerHeight();l(window).on("scroll",function(e){var o,t;function a(i){var e,t,a,s=i.featured_media;function r(){return'<header class="entry-header"><span class="posted-on"><time class="entry-date published">'+i.astrodj_date+'</time></span><div class="entry-meta"><span class="cat-links">'+function(){for(var e=i._embedded["wp:term"][0],t=[],a=0;a<e.length;a++)t.push('<a href="'+e[a].link+'" rel="category tag">'+e[a].name+"</a>");return t.join(", ")}()+'</span></div><h2 class="entry-title"><a href="'+i.link+'" rel="bookmark">'+i.title.rendered+"</a></h2></header>"}a='<article id="post-'+i.id+'" class="astrodj-post post front-page-infinite" data-previous-id="'+i.previous_post_ID+'"><div class="post__content">'+r()+(0===s?"":(e=(s=i._embedded["wp:featuredmedia"][0]).media_details.sizes.full.width,t=s.media_details.sizes.full.height,a="vertical"===i.meta.featured_image_format_meta?" vertical":"",'<div class="post-thumbnail-header"><a href="'+i.link+'"><figure class="astrodj-lqip post-thumbnail blog-thumbnail'+a+'" data-alt="'+s.alt_text+'" data-src="'+s.media_details.sizes.full.source_url+'" ><div class="aspect-ratio-fill" style="padding-bottom: 66.7%;width: 100%;height: 0;"></div><div class="astrodj-lqip__wrap"><img width="'+e+'" height="'+t+'" alt="" class="placeholder" src="'+s.media_details.sizes.astrodj_lqip.source_url+'"></div><div class="astrodj-lqip__wrap"><img width="'+e+'" height="'+t+'" class="lazy"></div></figure></a></div>'))+(""===i.excerpt.rendered?"":'<div class="entry-content">'+i.excerpt.rendered+"</div>")+"</div></article>",o.before(a),setInterval(function(){o.prev(".front-page-infinite").addClass("loaded")},150),o.find(".lds-ellipsis").hide(),d()}s>l(window).scrollTop()||(t=(o=i).prev("article").data("previous-id"),t=c+t+"?_embed=true"+p,o.find(".lds-ellipsis").show(),l.ajax({dataType:"json",url:t}).done(function(e){a(e),r()}).fail(function(){n&&console.log("error"),o.find(".lds-ellipsis").hide(),o.replaceWith('<article class=""><p>Постов больше нет...</p></article>')}),l(this).off(e))})}function r(){var s,e=[].slice.call(document.querySelectorAll("img.lazy"));"IntersectionObserver"in window&&(s=new IntersectionObserver(function(e,t){e.forEach(function(e){var t,a,i;e.isIntersecting&&(e=(t=e.target).closest(".astrodj-lqip__wrap").previousElementSibling,a=e.firstElementChild,i=t.closest("figure"),e.classList.add("bg"),setTimeout(function(){a.classList.add("visible"),t.alt=i.hasAttribute("data-alt")?i.dataset.alt:"",t.src=i.dataset.src,t.srcset=i.hasAttribute("data-srcset")?i.dataset.srcset:"",t.sizes=i.hasAttribute("data-sizes")?i.dataset.sizes:"",t.addEventListener("load",function(e){e.target.classList.add("visible")}),s.unobserve(t)},300))})},{threshold:.25}),e.forEach(function(e){s.observe(e)})),l("img.lazy").each(function(e){var t=parseInt(l(this).attr("width")),a=parseInt(l(this).attr("height")),a=a<t?100/(t/a):100*(a/t);l(this).parents(".astrodj-lqip__wrap").prevAll(".aspect-ratio-fill").attr("style","padding-bottom: "+a+"%;width: 100%;")})}t===Math.round(l(window).outerHeight()-e)?(e=Math.ceil(t/a),n&&console.log(e),l.ajax({type:"post",data:{posts_per_page:e,action:"astrodj_frontpage_init_query"},url:main_data.ajax_url}).done(function(e){l("#loader_container").before(e),l("#frontpage__loader").remove(),l("body").removeClass("frontpage__loader"),r(),d()}).fail(function(){})):(l("#frontpage__loader").remove(),l("body").removeClass("frontpage__loader"),d())})}(jQuery);